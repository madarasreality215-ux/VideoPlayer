<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MediaTracker Pro</title>
<style>
:root{--bg:#0b1220;--card:#0f1724;--card2:#141b2b;--txt:#e6eef9;--muted:rgba(230,238,249,.65);--acc:#7c3aed;--accH:#6d28d9;--thin:rgba(255,255,255,.15);--secBG:rgba(255,255,255,.03);--secBD:rgba(255,255,255,.08)}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--txt);font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica Neue,Arial}
header{position:sticky;top:0;z-index:50;display:flex;justify-content:space-between;align-items:center;background:var(--card);padding:12px 16px}
.title{margin:0;font-weight:700;font-size:18px;letter-spacing:.2px}
.btn{display:inline-flex;align-items:center;justify-content:center;gap:6px;height:42px;padding:10px 16px;border-radius:8px;border:none;font-weight:600;color:#fff;background:var(--acc);cursor:pointer;text-decoration:none;transition:background .2s,transform .1s}
.btn:hover{background:var(--accH);transform:translateY(-1px)}
.btn-matte{background:var(--card);color:var(--txt);border:1px solid var(--thin)}
.btn-matte:hover{background:#1a2333}
.container{display:grid;grid-template-columns:320px 1fr;gap:16px;padding:16px}
@media(max-width:900px){.container{grid-template-columns:1fr}}
.sidebar,.main{background:var(--card);padding:12px;border-radius:12px}
input,select,textarea{width:100%;padding:8px 10px;background:var(--card2);border:1px solid rgba(255,255,255,.1);border-radius:8px;color:var(--txt);font-size:14px}
input::placeholder,textarea::placeholder{color:rgba(230,238,249,.6)}
.section{background:var(--secBG);border:1px solid var(--secBD);border-radius:10px;padding:12px;margin-bottom:16px}
.section h3{margin:0 0 8px;font-size:15px;color:var(--acc);font-weight:700}
.row{display:flex;gap:10px;align-items:center;margin-bottom:10px}
.row:last-child{margin-bottom:0}
.empty{font-size:13px;color:var(--muted);text-align:center}
.vitem{display:flex;gap:10px;align-items:center;padding:8px;border-radius:10px;background:rgba(255,255,255,.02);cursor:grab;transition:background .2s}
.vitem:hover{background:rgba(255,255,255,.05)}
.thumb{width:120px;height:72px;background:#000;border-radius:8px;overflow:hidden;flex-shrink:0}
.thumb video{width:100%;height:100%;object-fit:cover;border-radius:8px}
.meta{flex:1;min-width:0}
.meta h4{margin:0;font-size:14px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.meta p{margin:4px 0 0;font-size:12px;color:var(--muted)}
.status{display:flex;align-items:center;gap:8px;font-size:13px;color:var(--muted)}
.dot{width:8px;height:8px;border-radius:50%;background:#22c55e}
</style>
</head>
<body>
<header><h1 class="title">üì± MediaTracker Pro</h1>
<div style="display:flex;gap:8px">
<a href="stats.html" class="btn btn-matte">üìä Stats</a>
<button id="signOutBtn" class="btn btn-matte">üö™ Sign Out</button>
</div></header>

<div class="container">
<aside class="sidebar">
  <div class="section">
    <button id="syncBtn" class="btn" style="width:100%">üîÑ Sync Now</button>
    <div class="status" style="margin-top:8px"><span class="dot" id="syncDot"></span><span id="syncText">Ready to sync</span></div>
  </div>

  <div class="section">
    <h3>üê¶ Twitter/X Downloader</h3>
    <div class="row"><input id="twUrl" placeholder="Paste Twitter/X URL here"></div>
    <div class="row"><button id="twFetch" class="btn" style="width:100%">Fetch Twitter Media</button></div>
    <div class="status" style="margin-top:8px"><span class="dot" id="apiDot" style="background:#60a5fa"></span><span id="apiText">Ready to detect media</span></div>
  </div>

  <!-- Tweet Preview Section -->
  <div id="tweetPreviewSection" class="section" style="display:none;">
    <h3>üéûÔ∏è Tweet Media Preview</h3>
    <div id="tweetPreview" class="vitem" style="cursor:default;">
      <div class="thumb"><video id="tweetPreviewVideo" muted autoplay loop></video></div>
      <div class="meta">
        <h4 id="tweetPreviewTitle">Previewing Tweet Media...</h4>
        <p>Detected video ‚Ä¢ Ready to download</p>
      </div>
    </div>
    <button id="tweetDownloadBtn" class="btn" style="width:100%;margin-top:10px;">‚¨áÔ∏è Download to VideoList</button>
  </div>
</aside>

<main class="main">
  <div class="section"><input type="search" id="searchInput" placeholder="üîç Search videos..."></div>
  <div id="videoList" class="videoList"></div>
</main>
</div>

<!-- Firebase (Compat SDK) -->
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-storage-compat.js"></script>

<script>
const firebaseConfig={apiKey:"AIzaSyBH691ymS0uO7JejXC1MGFuhiIElD78UPY",authDomain:"personalplayer-c8d3b.firebaseapp.com",projectId:"personalplayer-c8d3b",storageBucket:"personalplayer-c8d3b.appspot.com",messagingSenderId:"396785312809",appId:"1:396785312809:web:02290950ec22a13165a838"};
firebase.initializeApp(firebaseConfig);
const auth=firebase.auth(),db=firebase.firestore(),storage=firebase.storage();

let me=null;auth.onAuthStateChanged(u=>{if(!u){location.href='login.html';return}me=u});
document.getElementById("signOutBtn").onclick=()=>auth.signOut().then(()=>location.href="login.html");

function setApiStatus(s){const t=document.getElementById('apiText'),d=document.getElementById('apiDot');
 if(s==='busy'){t.textContent='Fetching tweet...';d.style.background='#f59e0b'}
 else if(s==='ok'){t.textContent='Media found!';d.style.background='#22c55e'}
 else if(s==='err'){t.textContent='Failed to detect media';d.style.background='#ef4444'}
 else{t.textContent='Ready to detect media';d.style.background='#60a5fa'}}

async function fxGet(tw){
  const ep1=`https://api.fxtwitter.com/${tw}`,ep2=`https://api.vxtwitter.com/${tw}`;
  let r=await fetch(ep1);if(!r.ok)r=await fetch(ep2);
  const j=await r.json();if(!j?.tweet)throw new Error('No tweet');return j;
}

let currentPreview=null;
async function fetchTweet(){
  const url=(document.getElementById('twUrl').value||'').trim();
  if(!url)return;setApiStatus('busy');
  try{
    const data=await fxGet(url);
    const medias=(data.tweet.media?.all||data.tweet.media?.videos||[]);
    if(!medias.length)throw new Error('No media found');
    const best=medias[0].variants ? medias[0].variants.sort((a,b)=>(b.bitrate||0)-(a.bitrate||0))[0] : medias[0];
    const src=best.url||medias[0].url;
    if(!src)throw new Error('No valid video URL');
    currentPreview=src;
    const v=document.getElementById('tweetPreviewVideo');
    v.src=src;v.load();
    document.getElementById('tweetPreviewSection').style.display='block';
    setApiStatus('ok');
  }catch(e){console.error(e);setApiStatus('err');}
}

document.getElementById('twFetch').onclick=fetchTweet;

document.getElementById('tweetDownloadBtn').onclick=async()=>{
  if(!currentPreview)return;
  const res=await fetch(currentPreview);
  const blob=await res.blob();
  const file=new File([blob],`tweet_${Date.now()}.mp4`,{type:'video/mp4'});
  const local=URL.createObjectURL(file);
  const el=document.createElement('div');
  el.className='vitem';
  el.innerHTML=`<div class="thumb"><video src="${local}" muted loop></video></div>
  <div class="meta"><h4>üéûÔ∏è Tweet Video</h4><p>${new Date().toLocaleString()}</p></div>`;
  document.getElementById('videoList').prepend(el);
  document.getElementById('tweetPreviewSection').style.display='none';
  setApiStatus('');
};
</script>
</body>
</html>
