[file name]: index.html
[file content begin]
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>MediaTracker Pro - Your Ultimate Media Organizer</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#7c3aed">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="MediaTracker">
<link rel="apple-touch-icon" href="icons/icon-192x192.png">

<style>
  :root{
    --bg-light:#f3f4f6;
    --bg-dark:#0b1220;
    --card-light:#ffffff;
    --card-dark:#0f1724;
    --text-light:#0f1724;
    --text-dark:#e6eef9;
    --accent:#7c3aed;
    --accent-hover:#6d28d9;
    --muted:rgba(230,238,249,0.65);
    --thumb-size:120px;
    --safe-area: env(safe-area-inset-bottom, 16px);
  }
  *{box-sizing:border-box}
  body{font-family:Inter,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial;margin:0;background:var(--bg-dark);color:var(--text-dark);transition:background .2s,color .2s}
  body.light{background:var(--bg-light);color:var(--text-light)}
  
  /* App container - hidden until authenticated */
  #appContainer{display:none}
  #appContainer.authenticated{display:block}
  
  header{display:flex;align-items:center;gap:12px;padding:12px 16px;background:var(--card-dark);position:sticky;top:0;z-index:100;}
  body.light header{background:var(--card-light)}
  h1{margin:0;font-size:18px}
  .controls{margin-left:auto;display:flex;gap:8px;align-items:center}
  .btn{background:var(--accent);color:white;padding:8px 10px;border-radius:8px;border:none;cursor:pointer;font-weight:600;transition:background .2s}
  .btn:hover{background:var(--accent-hover)}
  .ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 10px;border-radius:8px;color:inherit;cursor:pointer;transition:background .2s}
  .ghost:hover{background:rgba(255,255,255,0.05)}
  body.light .ghost{border-color:rgba(0,0,0,0.08)}
  body.light .ghost:hover{background:rgba(0,0,0,0.05)}
  
  .container{display:grid;grid-template-columns:320px 1fr;gap:16px;padding:16px;min-height:calc(100vh - 60px)}
  @media (max-width:960px){.container{grid-template-columns:1fr;}}
  @media (max-width:768px){.container{padding:12px;gap:12px;}}
  @media (max-width:480px){.container{padding:8px;gap:8px;}}
  
  .sidebar{background:var(--card-dark);padding:12px;border-radius:12px;min-height:60vh}
  body.light .sidebar{background:var(--card-light)}
  .main{background:var(--card-dark);padding:12px;border-radius:12px;min-height:60vh}
  body.light .main{background:var(--card-light)}

  .topbar{display:flex;gap:8px;align-items:center;margin-bottom:10px}
  input[type=search]{flex:1;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit;font-size:14px}
  body.light input[type=search]{border-color:rgba(0,0,0,0.08)}

  .folders{display:flex;flex-direction:column;gap:8px;max-height:40vh;overflow:auto;padding-right:6px}
  .folder{display:flex;align-items:center;gap:8px;padding:8px;border-radius:10px;background:rgba(255,255,255,0.02);cursor:pointer;transition:background .2s}
  .folder:hover{background:rgba(255,255,255,0.05)}
  .folder .name{flex:1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .folder .count{font-size:12px;color:var(--muted)}
  
  /* Folder collapse/expand styles */
  .folder-header{display:flex;align-items:center;gap:8px;padding:8px;border-radius:10px;background:rgba(255,255,255,0.02);cursor:pointer;transition:background-color 0.2s}
  .folder-header:hover{background:rgba(255,255,255,0.05)}
  .folder-header .icon{transition:transform 0.2s;width:16px;height:16px;display:flex;align-items:center;justify-content:center}
  .folder-header.collapsed .icon{transform:rotate(-90deg)}
  .folder-content{overflow:hidden;transition:max-height 0.3s ease-out}
  .folder-content.collapsed{max-height:0}
  .nested-folder{margin-left:20px;border-left:1px solid rgba(255,255,255,0.1);padding-left:8px}
  body.light .nested-folder{border-left-color:rgba(0,0,0,0.1)}

  .videoList{display:flex;flex-direction:column;gap:8px;max-height:40vh;overflow:auto}
  .vitem{display:flex;gap:10px;align-items:center;padding:8px;border-radius:10px;background:rgba(255,255,255,0.02);cursor:pointer;transition:background .2s}
  .vitem:hover{background:rgba(255,255,255,0.05)}
  .vitem.dragging{opacity:0.5;background:rgba(124,58,237,0.2);transform:scale(0.95)}
  .vitem.drop-target{background:rgba(124,58,237,0.1);border:2px dashed var(--accent)}
  .folder.drop-target{background:rgba(124,58,237,0.1);border:2px dashed var(--accent)}
  .thumb{width:var(--thumb-size);height:calc(var(--thumb-size)*0.6);background:#000;border-radius:8px;overflow:hidden;flex-shrink:0}
  .thumb img{width:100%;height:100%;object-fit:cover}
  .meta{flex:1;min-width:0}
  .meta h3{margin:0;font-size:14px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .meta p{margin:4px 0 0 0;font-size:12px;color:var(--muted)}

  .viewer video{width:100%;height:auto;max-height:70vh;background:#000;border-radius:8px}
  .fields{display:flex;gap:8px;margin-top:8px;flex-wrap:wrap}
  .fields input,.fields textarea,.fields select{padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit;font-size:14px;flex:1;min-width:150px}
  body.light .fields input,body.light .fields textarea,body.light .fields select{border-color:rgba(0,0,0,0.08)}
  .small{font-size:12px;color:var(--muted)}

  .folder-actions{display:flex;gap:8px;margin-top:8px}
  .collapse{opacity:0.8}
  .controls .btn-sm{padding:6px 8px;font-size:13px}

  /* Action Sections */
  .action-section{margin-top:16px;padding:12px;background:rgba(255,255,255,0.02);border-radius:8px;border:1px solid rgba(255,255,255,0.04)}
  body.light .action-section{background:rgba(0,0,0,0.02);border-color:rgba(0,0,0,0.08)}
  .action-section h3{margin:0 0 8px 0;font-size:14px;color:var(--accent)}
  .action-buttons{display:flex;flex-direction:column;gap:8px}
  .action-buttons .btn,.action-buttons .ghost{width:100%;justify-content:center;text-align:center}
  
  /* Mobile-specific styles - Enhanced for iOS/Android */
  .mobile-controls{display:none;position:fixed;bottom:0;left:0;right:0;background:var(--card-dark);padding:12px;border-top:1px solid rgba(255,255,255,0.1);z-index:100;padding-bottom: calc(12px + var(--safe-area))}
  body.light .mobile-controls{background:var(--card-light);border-top-color:rgba(0,0,0,0.1)}
  .mobile-controls-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  
  /* Media type indicators */
  .media-type-badge{background:var(--accent);color:white;padding:2px 6px;border-radius:4px;font-size:10px;font-weight:600}
  .media-type-photo{background:#10b981}
  .media-type-video{background:#7c3aed}
  
  /* Add Media Buttons */
  .add-media-buttons{display:flex;gap:8px;margin-top:8px}
  .add-media-buttons .btn{flex:1;min-width:0} /* Ensure equal width */
  
  /* Firebase sync status */
  .sync-status{display:flex;align-items:center;gap:6px;font-size:12px;color:var(--muted);margin-top:8px}
  .sync-indicator{width:8px;height:8px;border-radius:50%;background:#10b981}
  .sync-indicator.syncing{background:#f59e0b;animation:pulse 1.5s infinite}
  .sync-indicator.error{background:#ef4444}
  @keyframes pulse{0%{opacity:1}50%{opacity:0.5}100%{opacity:1}}
  
  /* Auth Screen Styles */
  #authScreen{min-height:100vh;display:flex;align-items:center;justify-content:center;background:var(--bg-dark);color:var(--text-dark);transition:background .2s,color .2s}
  body.light #authScreen{background:var(--bg-light);color:var(--text-light)}
  .auth-container{width:90%;max-width:400px;padding:40px 0}
  .auth-card{background:var(--card-dark);padding:32px;border-radius:16px;box-shadow:0 10px 25px rgba(0,0,0,0.3);text-align:center}
  body.light .auth-card{background:var(--card-light)}
  .auth-logo{font-size:28px;font-weight:700;margin-bottom:8px;color:var(--accent)}
  .auth-subtitle{color:var(--muted);margin-bottom:32px;font-size:16px}
  .auth-form{display:flex;flex-direction:column;gap:16px}
  .auth-form input{padding:14px;border-radius:8px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.05);color:inherit;font-size:16px;width:100%}
  body.light .auth-form input{border-color:rgba(0,0,0,0.1);background:rgba(0,0,0,0.05)}
  .auth-primary-btn{background:var(--accent);color:white;padding:14px;border-radius:8px;border:none;cursor:pointer;font-weight:600;font-size:16px;transition:background .2s;width:100%}
  .auth-primary-btn:hover{background:var(--accent-hover)}
  .auth-secondary-btn{background:transparent;border:1px solid rgba(255,255,255,0.1);color:inherit;padding:14px;border-radius:8px;cursor:pointer;font-size:16px;transition:background .2s;width:100%}
  .auth-secondary-btn:hover{background:rgba(255,255,255,0.05)}
  .auth-switch{text-align:center;margin-top:24px;font-size:15px;color:var(--muted)}
  .auth-switch-btn{background:none;border:none;color:var(--accent);cursor:pointer;text-decoration:underline;font-size:15px;margin-left:4px}
  .auth-error{color:#ef4444;font-size:14px;text-align:center;margin-top:12px;display:none}
  .auth-loading{display:none;text-align:center;margin-top:16px}

  /* Upload Progress Styles */
  .upload-progress {margin-top: 12px; padding: 12px; background: rgba(255,255,255,0.02); border-radius: 8px; border: 1px solid rgba(255,255,255,0.04)}
  .progress-bar {width: 100%; height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; overflow: hidden; margin-top: 8px}
  .progress-fill {height: 100%; background: var(--accent); transition: width 0.3s ease}
  .progress-text {font-size: 12px; color: var(--muted); margin-top: 4px}
  .duplicate-warning {background: rgba(245,158,11,0.1); border: 1px solid rgba(245,158,11,0.3); padding: 8px; border-radius: 6px; margin-top: 8px; font-size: 12px}
  
  /* Cloud Storage Styles */
  .cloud-storage-dropdown {position: relative; display: inline-block; width: 100%;}
  .cloud-storage-btn {width: 100%; padding: 10px; background: transparent; border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: inherit; cursor: pointer; display: flex; align-items: center; justify-content: space-between; font-size: 14px;}
  .cloud-storage-btn:hover {background: rgba(255,255,255,0.05);}
  .cloud-dropdown-content {display: none; position: absolute; top: 100%; left: 0; right: 0; background: var(--card-dark); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; padding: 8px; z-index: 1000; margin-top: 4px;}
  .cloud-dropdown-content.show {display: block;}
  .cloud-option {padding: 10px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: background 0.2s;}
  .cloud-option:hover {background: rgba(255,255,255,0.05);}
  .cloud-option.google {color: #4285F4;}
  .cloud-option.dropbox {color: #0061FF;}
  .cloud-option.mega {color: #D90007;}
  .cloud-browser {margin-top: 12px; padding: 12px; background: rgba(255,255,255,0.02); border-radius: 8px; border: 1px solid rgba(255,255,255,0.04); display: none;}
  .cloud-browser.show {display: block;}
  .cloud-folder {padding: 8px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 8px; margin-bottom: 4px;}
  .cloud-folder:hover {background: rgba(255,255,255,0.05);}
  .cloud-file {padding: 8px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 8px; margin-bottom: 4px;}
  .cloud-file:hover {background: rgba(255,255,255,0.05);}
  .cloud-back {padding: 8px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 8px; margin-bottom: 8px; color: var(--accent);}
  .cloud-back:hover {background: rgba(255,255,255,0.05);}

  /* URL Downloader Dropdown Styles */
  .url-downloader-dropdown {position: relative; display: inline-block; width: 100%;}
  .url-downloader-btn {width: 100%; padding: 10px; background: transparent; border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: inherit; cursor: pointer; display: flex; align-items: center; justify-content: space-between; font-size: 14px;}
  .url-downloader-btn:hover {background: rgba(255,255,255,0.05);}
  .url-downloader-content {display: none; position: absolute; top: 100%; left: 0; right: 0; background: var(--card-dark); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; padding: 8px; z-index: 1000; margin-top: 4px;}
  .url-downloader-content.show {display: block;}
  .url-option {padding: 10px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: background 0.2s;}
  .url-option:hover {background: rgba(255,255,255,0.05);}
  .url-input-group {display: flex; gap: 8px; margin-bottom: 8px;}
  .url-input-group input {flex: 1; padding: 10px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.05); color: inherit;}

  /* Custom Modal Styles */
  .modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.7);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 10000;
  }
  .modal-overlay.show {
    display: flex;
  }
  .modal {
    background: var(--card-dark);
    border-radius: 12px;
    padding: 24px;
    max-width: 400px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
  }
  body.light .modal {
    background: var(--card-light);
  }
  .modal h3 {
    margin: 0 0 16px 0;
    color: var(--accent);
  }
  .modal-buttons {
    display: flex;
    gap: 12px;
    margin-top: 20px;
    justify-content: flex-end;
  }
  .modal-buttons .btn {
    min-width: 80px;
  }

  /* Enhanced Video Player */
  .video-player-container {
    position: relative;
    background: #000;
    border-radius: 8px;
    overflow: hidden;
  }
  .video-controls {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: linear-gradient(transparent, rgba(0,0,0,0.7));
    padding: 16px;
    display: flex;
    align-items: center;
    gap: 12px;
    opacity: 0;
    transition: opacity 0.3s;
  }
  .video-player-container:hover .video-controls {
    opacity: 1;
  }
  .control-btn {
    background: none;
    border: none;
    color: white;
    font-size: 20px;
    cursor: pointer;
    padding: 8px;
  }
  .progress-container {
    flex: 1;
    height: 4px;
    background: rgba(255,255,255,0.3);
    border-radius: 2px;
    cursor: pointer;
    position: relative;
  }
  .progress-bar {
    height: 100%;
    background: var(--accent);
    border-radius: 2px;
    width: 0%;
  }
  .time-display {
    color: white;
    font-size: 14px;
    min-width: 100px;
    text-align: center;
  }

  /* File Conversion Tools */
  .conversion-tools {
    margin-top: 12px;
    padding: 12px;
    background: rgba(255,255,255,0.02);
    border-radius: 8px;
    border: 1px solid rgba(255,255,255,0.04);
  }
  .conversion-options {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
    margin-top: 8px;
  }
  .conversion-option {
    padding: 10px;
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 8px;
    text-align: center;
    cursor: pointer;
    transition: background 0.2s;
  }
  .conversion-option:hover {
    background: rgba(255,255,255,0.05);
  }

  /* Install Prompt */
  .install-prompt {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: var(--accent);
    color: white;
    padding: 12px 16px;
    border-radius: 8px;
    display: none;
    align-items: center;
    gap: 12px;
    z-index: 1000;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  }
  .install-prompt.show {
    display: flex;
  }
  .install-close {
    background: none;
    border: none;
    color: white;
    cursor: pointer;
    font-size: 18px;
  }

  /* Context Menu */
  .context-menu {
    position: fixed;
    background: var(--card-dark);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 8px;
    padding: 8px;
    z-index: 1000;
    display: none;
    min-width: 150px;
  }
  .context-menu.show {
    display: block;
  }
  .context-item {
    padding: 8px 12px;
    border-radius: 6px;
    cursor: pointer;
    transition: background 0.2s;
  }
  .context-item:hover {
    background: rgba(255,255,255,0.05);
  }
  .context-item.danger {
    color: #ef4444;
  }

  /* Enhanced mobile styles */
  @media (max-width:768px){
    .container{min-height:calc(100vh - 120px);margin-bottom:70px}
    .mobile-controls{display:block}
    .desktop-controls{display:none}
    .folders, .videoList{max-height:30vh}
    .fields{flex-direction:column}
    .fields input,.fields textarea,.fields select{min-width:auto}
    .viewer video{max-height:50vh}
    .thumb{width:80px;height:48px}
    
    /* Better touch targets for mobile */
    .vitem, .folder, .folder-header{padding:12px 10px;min-height:48px}
    .btn, .ghost{min-height:44px;display:flex;align-items:center;justify-content:center}
    
    /* Improved mobile header */
    header{padding:10px 12px}
    h1{font-size:16px}
    
    /* Better mobile controls layout */
    .mobile-controls-grid{grid-template-columns:1fr 1fr;gap:8px}
    
    /* Mobile auth styles */
    .auth-card{padding:24px;margin:20px}
    .auth-container{padding:20px 0}

    /* Mobile video controls */
    .video-controls {
      opacity: 1;
      padding: 12px;
    }
    .control-btn {
      font-size: 18px;
      padding: 6px;
    }

    /* Mobile conversion tools */
    .conversion-options {
      grid-template-columns: 1fr;
    }
  }
  
  @media (max-width:480px){
    header{padding:8px 12px}
    .container{padding-bottom:80px}
    .sidebar, .main{padding:8px}
    .mobile-controls{padding:10px}
    .mobile-controls-grid{grid-template-columns:1fr 1fr;gap:6px}
    .action-buttons .btn,.action-buttons .ghost{padding:10px;font-size:14px}
    
    /* Stack add media buttons on very small screens */
    .add-media-buttons{flex-direction:column}
    
    /* Mobile auth styles */
    .auth-card{padding:20px 16px}

    /* Mobile install prompt */
    .install-prompt {
      bottom: 80px;
      right: 12px;
      left: 12px;
    }
  }

  /* Tablet-specific improvements */
  @media (min-width:769px) and (max-width:1024px){
    .container{grid-template-columns:280px 1fr;gap:12px}
    .thumb{width:100px;height:60px}
  }

  /* Touch-friendly improvements for all touch devices */
  @media (hover: none) and (pointer: coarse){
    .vitem, .folder, .folder-header{padding:14px 10px;min-height:52px}
    .btn, .ghost{min-height:48px;display:flex;align-items:center;justify-content:center;font-size:15px}
    input, textarea, select{font-size:16px;padding:12px 10px} /* Prevents zoom on iOS */
    
    /* Better touch feedback */
    .vitem:active, .folder:active, .folder-header:active{background:rgba(124,58,237,0.2)}

    /* Always show video controls on touch devices */
    .video-controls {
      opacity: 1;
    }
  }

  /* iOS Safari specific fixes */
  @supports (-webkit-touch-callout: none) {
    .mobile-controls{padding-bottom: max(12px, var(--safe-area))}
    .container{min-height: calc(100vh - 60px - env(safe-area-inset-bottom))}
    
    /* iPhone 12 Pro Max specific optimizations */
    @media (device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) {
      .container{min-height: calc(100vh - 60px - 34px)} /* Account for dynamic island */
      .mobile-controls{padding-bottom: max(12px, 34px)}
    }
  }
</style>
</head>
<body>
<!-- Authentication Screen (Shown First) -->
<div id="authScreen">
  <div class="auth-container">
    <div class="auth-card">
      <div class="auth-logo">üì± MediaTracker Pro</div>
      <div class="auth-subtitle" id="authSubtitle">Sign in to your media library üìÇ</div>
      
      <div id="authError" class="auth-error"></div>
      <div id="authLoading" class="auth-loading">
        <div class="small">Loading...</div>
      </div>
      
      <form id="authForm" class="auth-form">
        <input type="email" id="authEmail" placeholder="Email" required>
        <input type="password" id="authPassword" placeholder="Password" required>
        <button type="submit" id="authSubmit" class="auth-primary-btn">Sign In</button>
      </form>
    </div>
  </div>
</div>

<!-- Main App (Hidden until authenticated) -->
<div id="appContainer">
  <header>
    <h1>üì± MediaTracker Pro</h1>
    <div class="controls desktop-controls">
      <!-- Stats button with improved navigation -->
      <a href="stats.html" class="ghost" style="text-decoration: none; color: inherit; display: flex; align-items: center; gap: 4px;">
        üìä Stats
      </a>
      <button id="themeBtn" class="ghost">üåô</button>
      <button id="signOutBtn" class="ghost">üö™ Sign Out</button>
    </div>
  </header>

  <div class="container">
    <aside class="sidebar">
      <div class="topbar">
        <button id="syncBtn" class="btn" style="flex:1">üîÑ Sync Now</button>
      </div>

      <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px">
        <input id="newFolderName" style="flex:1;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit" placeholder="New folder name">
        <button id="addFolderBtn" class="btn btn-sm">üìÅ Add</button>
      </div>

      <div class="folders" id="folders"></div>

      <!-- Add Media Section -->
      <div class="action-section">
        <h3>‚ûï Add Media</h3>
        <div class="add-media-buttons">
          <label style="display:block;flex:1">
            <input id="fileInputVideo" type="file" accept="video/*" multiple style="display:none">
            <button id="addVideoBtn" class="btn">üé• Add Videos</button>
          </label>
          <label style="display:block;flex:1">
            <input id="fileInputPhoto" type="file" accept="image/*" multiple style="display:none">
            <button id="addPhotoBtn" class="btn" style="background:#10b981">üì∑ Add Photos</button>
          </label>
        </div>
        <div class="small" style="text-align:center;margin-top:4px">Supports MP4, WebM, MOV, JPG, PNG, GIF</div>
        
        <!-- URL Downloader Dropdown -->
        <div class="url-downloader-dropdown">
          <button class="url-downloader-btn" id="urlDownloaderBtn">
            <span>üîó Download from URL (FREE)</span>
            <span>‚ñº</span>
          </button>
          <div class="url-downloader-content" id="urlDownloaderDropdown">
            <div class="url-option" data-type="ninexbuddy">
              <span>üé¨</span>
              <span>9xBuddy (Multiple Sites)</span>
            </div>
            <div class="url-option" data-type="twitter">
              <span>üê¶</span>
              <span>Twitter/X Video</span>
            </div>
            <div class="url-option" data-type="direct">
              <span>üîó</span>
              <span>Direct Video URL</span>
            </div>
          </div>
        </div>
        
        <!-- 9xBuddy Downloader -->
        <div class="url-downloader" id="ninexbuddyDownloader" style="display:none; margin-top:12px;">
          <div class="url-input-group">
            <input type="url" id="ninexbuddyUrl" placeholder="Paste video URL for 9xBuddy">
            <button id="downloadNinexbuddyBtn" class="btn">üé¨ Download via 9xBuddy</button>
          </div>
          <div class="small" style="text-align:center">Uses 9xBuddy - Download videos from multiple platforms</div>
          <div id="ninexbuddyProgress" class="upload-progress" style="display:none; margin-top:8px">
            <div class="small">Downloading video via 9xBuddy...</div>
            <div class="progress-bar">
              <div class="progress-fill" id="ninexbuddyProgressFill"></div>
            </div>
            <div class="progress-text" id="ninexbuddyProgressText">0%</div>
          </div>
        </div>
        
        <!-- Twitter Downloader -->
        <div class="url-downloader" id="twitterDownloader" style="display:none; margin-top:12px;">
          <div class="url-input-group">
            <input type="url" id="twitterUrl" placeholder="Paste Twitter/X URL">
            <button id="downloadTwitterBtn" class="btn">üê¶ Download via TwitSave</button>
          </div>
          <div class="small" style="text-align:center">Uses TwitSave - Free Twitter video downloader</div>
          <div id="twitterProgress" class="upload-progress" style="display:none; margin-top:8px">
            <div class="small">Downloading Twitter video...</div>
            <div class="progress-bar">
              <div class="progress-fill" id="twitterProgressFill"></div>
            </div>
            <div class="progress-text" id="twitterProgressText">0%</div>
          </div>
        </div>
        
        <!-- Direct URL Downloader -->
        <div class="url-downloader" id="directUrlDownloader" style="display:none; margin-top:12px;">
          <div class="url-input-group">
            <input type="url" id="directUrl" placeholder="Paste direct video URL">
            <button id="downloadDirectBtn" class="btn">üé¨ Download Free</button>
          </div>
          <div class="small" style="text-align:center">Supports MP4, WebM, MOV files</div>
          <div id="directUrlProgress" class="upload-progress" style="display:none; margin-top:8px">
            <div class="small">Downloading video...</div>
            <div class="progress-bar">
              <div class="progress-fill" id="directUrlProgressFill"></div>
            </div>
            <div class="progress-text" id="directUrlProgressText">0%</div>
          </div>
        </div>
      </div>

      <!-- File Conversion Tools -->
      <div class="action-section">
        <h3>üõ†Ô∏è File Tools</h3>
        <div class="conversion-tools">
          <div class="small" style="margin-bottom:8px">Convert files between formats:</div>
          <div class="conversion-options">
            <div class="conversion-option" data-convert="mp4-to-webm">
              <div>MP4 ‚Üí WebM</div>
              <div class="small">Smaller size</div>
            </div>
            <div class="conversion-option" data-convert="webm-to-mp4">
              <div>WebM ‚Üí MP4</div>
              <div class="small">Better compatibility</div>
            </div>
            <div class="conversion-option" data-convert="jpg-to-png">
              <div>JPG ‚Üí PNG</div>
              <div class="small">Lossless</div>
            </div>
            <div class="conversion-option" data-convert="png-to-jpg">
              <div>PNG ‚Üí JPG</div>
              <div class="small">Smaller size</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Sync Status -->
      <div class="sync-status">
        <div class="sync-indicator" id="syncIndicator"></div>
        <span id="syncStatusText">Ready to sync</span>
      </div>
    </aside>

    <main class="main">
      <div class="topbar">
        <input type="search" id="searchInput" placeholder="Search videos and photos...">
        <button id="sortBtn" class="ghost">üìÖ Sort: Newest</button>
      </div>

      <div class="videoList" id="videoList"></div>

      <div class="viewer" id="viewer" style="display:none">
        <video id="videoPlayer" controls></video>
        <img id="imageViewer" style="display:none; width:100%; height:auto; max-height:70vh; object-fit:contain; border-radius:8px">
        
        <div class="fields">
          <input id="editTitle" placeholder="Title">
          <input id="editTags" placeholder="Tags (comma separated)">
          <select id="editFolder">
            <option value="">No folder</option>
          </select>
        </div>
        <div class="fields">
          <textarea id="editDescription" placeholder="Description" rows="3"></textarea>
        </div>
        <div class="folder-actions">
          <button id="saveBtn" class="btn">üíæ Save</button>
          <button id="deleteBtn" class="btn" style="background:#ef4444">üóëÔ∏è Delete</button>
          <button id="closeBtn" class="ghost">‚úï Close</button>
        </div>
      </div>
    </main>
  </div>

  <!-- Mobile Controls -->
  <div class="mobile-controls">
    <div class="mobile-controls-grid">
      <button id="mobileAddVideo" class="btn">üé• Add Video</button>
      <button id="mobileAddPhoto" class="btn" style="background:#10b981">üì∑ Add Photo</button>
      <button id="mobileSync" class="btn">üîÑ Sync</button>
      <button id="mobileStats" class="btn">üìä Stats</button>
    </div>
  </div>

  <!-- Install Prompt -->
  <div class="install-prompt" id="installPrompt">
    <span>üì± Install MediaTracker Pro</span>
    <button id="installBtn" class="btn" style="background:white;color:var(--accent);padding:6px 12px;font-size:14px">Install</button>
    <button class="install-close" id="installClose">‚úï</button>
  </div>

  <!-- Context Menu -->
  <div class="context-menu" id="contextMenu">
    <div class="context-item" data-action="rename">‚úèÔ∏è Rename</div>
    <div class="context-item" data-action="move">üìÇ Move to Folder</div>
    <div class="context-item" data-action="delete" class="danger">üóëÔ∏è Delete</div>
  </div>

  <!-- Modal for Rename -->
  <div class="modal-overlay" id="renameModal">
    <div class="modal">
      <h3>‚úèÔ∏è Rename Media</h3>
      <input type="text" id="renameInput" placeholder="Enter new name" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.1);background:transparent;color:inherit">
      <div class="modal-buttons">
        <button id="renameCancel" class="ghost">Cancel</button>
        <button id="renameSave" class="btn">Save</button>
      </div>
    </div>
  </div>

  <!-- Modal for Move to Folder -->
  <div class="modal-overlay" id="moveModal">
    <div class="modal">
      <h3>üìÇ Move to Folder</h3>
      <select id="folderSelect" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.1);background:transparent;color:inherit">
        <option value="">No folder</option>
      </select>
      <div class="modal-buttons">
        <button id="moveCancel" class="ghost">Cancel</button>
        <button id="moveSave" class="btn">Move</button>
      </div>
    </div>
  </div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>

<script>
  // Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyBH691ymS0uO7JejXC1MGFuhiIElD78UPY",
    authDomain: "personalplayer-c8d3b.firebaseapp.com",
    projectId: "personalplayer-c8d3b",
    storageBucket: "personalplayer-c8d3b.firebasestorage.app",
    messagingSenderId: "396785312809",
    appId: "1:396785312809:web:02290950ec22a13165a838",
    measurementId: "G-2Q8W3GJF1S"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();
  const storage = firebase.storage();

  // App state
  let currentUser = null;
  let mediaItems = [];
  let folders = [];
  let currentMedia = null;
  let isSyncing = false;
  let deferredPrompt = null;

  // DOM elements
  const authScreen = document.getElementById('authScreen');
  const appContainer = document.getElementById('appContainer');
  const authForm = document.getElementById('authForm');
  const authEmail = document.getElementById('authEmail');
  const authPassword = document.getElementById('authPassword');
  const authSubmit = document.getElementById('authSubmit');
  const authError = document.getElementById('authError');
  const authLoading = document.getElementById('authLoading');
  const authSubtitle = document.getElementById('authSubtitle');
  const signOutBtn = document.getElementById('signOutBtn');
  const themeBtn = document.getElementById('themeBtn');
  const syncBtn = document.getElementById('syncBtn');
  const syncIndicator = document.getElementById('syncIndicator');
  const syncStatusText = document.getElementById('syncStatusText');
  const foldersEl = document.getElementById('folders');
  const newFolderName = document.getElementById('newFolderName');
  const addFolderBtn = document.getElementById('addFolderBtn');
  const videoList = document.getElementById('videoList');
  const searchInput = document.getElementById('searchInput');
  const sortBtn = document.getElementById('sortBtn');
  const viewer = document.getElementById('viewer');
  const videoPlayer = document.getElementById('videoPlayer');
  const imageViewer = document.getElementById('imageViewer');
  const editTitle = document.getElementById('editTitle');
  const editTags = document.getElementById('editTags');
  const editFolder = document.getElementById('editFolder');
  const editDescription = document.getElementById('editDescription');
  const saveBtn = document.getElementById('saveBtn');
  const deleteBtn = document.getElementById('deleteBtn');
  const closeBtn = document.getElementById('closeBtn');
  const fileInputVideo = document.getElementById('fileInputVideo');
  const fileInputPhoto = document.getElementById('fileInputPhoto');
  const addVideoBtn = document.getElementById('addVideoBtn');
  const addPhotoBtn = document.getElementById('addPhotoBtn');
  const mobileAddVideo = document.getElementById('mobileAddVideo');
  const mobileAddPhoto = document.getElementById('mobileAddPhoto');
  const mobileSync = document.getElementById('mobileSync');
  const mobileStats = document.getElementById('mobileStats');
  const installPrompt = document.getElementById('installPrompt');
  const installBtn = document.getElementById('installBtn');
  const installClose = document.getElementById('installClose');
  const contextMenu = document.getElementById('contextMenu');
  const renameModal = document.getElementById('renameModal');
  const renameInput = document.getElementById('renameInput');
  const renameSave = document.getElementById('renameSave');
  const renameCancel = document.getElementById('renameCancel');
  const moveModal = document.getElementById('moveModal');
  const folderSelect = document.getElementById('folderSelect');
  const moveSave = document.getElementById('moveSave');
  const moveCancel = document.getElementById('moveCancel');

  // URL Downloader elements
  const urlDownloaderBtn = document.getElementById('urlDownloaderBtn');
  const urlDownloaderDropdown = document.getElementById('urlDownloaderDropdown');
  const ninexbuddyDownloader = document.getElementById('ninexbuddyDownloader');
  const twitterDownloader = document.getElementById('twitterDownloader');
  const directUrlDownloader = document.getElementById('directUrlDownloader');
  const downloadNinexbuddyBtn = document.getElementById('downloadNinexbuddyBtn');
  const downloadTwitterBtn = document.getElementById('downloadTwitterBtn');
  const downloadDirectBtn = document.getElementById('downloadDirectBtn');

  // Initialize app
  function initApp() {
    // Auth state listener
    auth.onAuthStateChanged((user) => {
      if (user) {
        currentUser = user;
        showApp();
        loadData();
      } else {
        showAuth();
      }
    });

    // Event listeners
    authForm.addEventListener('submit', handleAuth);
    signOutBtn.addEventListener('click', signOut);
    themeBtn.addEventListener('click', toggleTheme);
    syncBtn.addEventListener('click', syncData);
    addFolderBtn.addEventListener('click', addFolder);
    searchInput.addEventListener('input', renderMediaList);
    sortBtn.addEventListener('click', toggleSort);
    saveBtn.addEventListener('click', saveMedia);
    deleteBtn.addEventListener('click', deleteMedia);
    closeBtn.addEventListener('click', closeViewer);
    
    // File upload handlers
    addVideoBtn.addEventListener('click', () => fileInputVideo.click());
    addPhotoBtn.addEventListener('click', () => fileInputPhoto.click());
    mobileAddVideo.addEventListener('click', () => fileInputVideo.click());
    mobileAddPhoto.addEventListener('click', () => fileInputPhoto.click());
    fileInputVideo.addEventListener('change', handleFileUpload);
    fileInputPhoto.addEventListener('change', handleFileUpload);
    
    // Mobile sync
    mobileSync.addEventListener('click', syncData);
    
    // PWA install
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      installPrompt.classList.add('show');
    });
    
    installBtn.addEventListener('click', async () => {
      if (deferredPrompt) {
        deferredPrompt.prompt();
        const { outcome } = await deferredPrompt.userChoice;
        if (outcome === 'accepted') {
          installPrompt.classList.remove('show');
        }
        deferredPrompt = null;
      }
    });
    
    installClose.addEventListener('click', () => {
      installPrompt.classList.remove('show');
    });

    // Context menu
    document.addEventListener('click', () => {
      contextMenu.classList.remove('show');
    });
    
    document.addEventListener('contextmenu', (e) => {
      e.preventDefault();
    });

    // Modals
    renameCancel.addEventListener('click', () => renameModal.classList.remove('show'));
    moveCancel.addEventListener('click', () => moveModal.classList.remove('show'));
    
    renameSave.addEventListener('click', saveRename);
    moveSave.addEventListener('click', saveMove);

    // URL Downloader handlers
    urlDownloaderBtn.addEventListener('click', () => {
      urlDownloaderDropdown.classList.toggle('show');
    });

    document.addEventListener('click', (e) => {
      if (!urlDownloaderBtn.contains(e.target) && !urlDownloaderDropdown.contains(e.target)) {
        urlDownloaderDropdown.classList.remove('show');
      }
    });

    // URL downloader options
    document.querySelectorAll('.url-option').forEach(option => {
      option.addEventListener('click', () => {
        const type = option.dataset.type;
        showUrlDownloader(type);
      });
    });

    downloadNinexbuddyBtn.addEventListener('click', downloadViaNinexbuddy);
    downloadTwitterBtn.addEventListener('click', downloadViaTwitter);
    downloadDirectBtn.addEventListener('click', downloadDirectUrl);

    // File conversion tools
    document.querySelectorAll('.conversion-option').forEach(option => {
      option.addEventListener('click', () => {
        const conversion = option.dataset.convert;
        handleFileConversion(conversion);
      });
    });

    // Load theme
    loadTheme();
  }

  // Authentication functions
  function handleAuth(e) {
    e.preventDefault();
    const email = authEmail.value;
    const password = authPassword.value;
    
    showAuthLoading(true);
    authError.style.display = 'none';

    auth.signInWithEmailAndPassword(email, password)
      .then(() => {
        // Success - handled by auth state listener
      })
      .catch((error) => {
        showAuthError(error.message);
      })
      .finally(() => {
        showAuthLoading(false);
      });
  }

  function showAuthError(message) {
    authError.textContent = message;
    authError.style.display = 'block';
  }

  function showAuthLoading(show) {
    authLoading.style.display = show ? 'block' : 'none';
    authSubmit.disabled = show;
  }

  function showAuth() {
    authScreen.style.display = 'flex';
    appContainer.classList.remove('authenticated');
  }

  function showApp() {
    authScreen.style.display = 'none';
    appContainer.classList.add('authenticated');
  }

  function signOut() {
    auth.signOut();
  }

  // Theme functions
  function toggleTheme() {
    const isLight = document.body.classList.toggle('light');
    themeBtn.textContent = isLight ? '‚òÄÔ∏è' : 'üåô';
    localStorage.setItem('theme', isLight ? 'light' : 'dark');
  }

  function loadTheme() {
    const savedTheme = localStorage.getItem('theme') || 'dark';
    if (savedTheme === 'light') {
      document.body.classList.add('light');
      themeBtn.textContent = '‚òÄÔ∏è';
    }
  }

  // Data management
  async function loadData() {
    try {
      await loadFolders();
      await loadMedia();
      renderFolders();
      renderMediaList();
      updateSyncStatus('ready');
    } catch (error) {
      console.error('Error loading data:', error);
      updateSyncStatus('error');
    }
  }

  async function loadFolders() {
    const snapshot = await db.collection('users').doc(currentUser.uid).collection('folders').get();
    folders = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
  }

  async function loadMedia() {
    const snapshot = await db.collection('users').doc(currentUser.uid).collection('media').get();
    mediaItems = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
  }

  function addFolder() {
    const name = newFolderName.value.trim();
    if (!name) return;

    const folder = {
      name,
      createdAt: firebase.firestore.FieldValue.serverTimestamp(),
      itemCount: 0
    };

    db.collection('users').doc(currentUser.uid).collection('folders').add(folder)
      .then(() => {
        newFolderName.value = '';
        loadData();
      })
      .catch(error => {
        console.error('Error adding folder:', error);
      });
  }

  // Render functions
  function renderFolders() {
    foldersEl.innerHTML = '';
    
    folders.forEach(folder => {
      const folderEl = document.createElement('div');
      folderEl.className = 'folder';
      folderEl.draggable = true;
      folderEl.innerHTML = `
        <span class="name">${folder.name}</span>
        <span class="count">${folder.itemCount || 0}</span>
      `;
      
      folderEl.addEventListener('click', () => filterByFolder(folder.id));
      folderEl.addEventListener('dragstart', (e) => onDragStart(e, 'folder', folder.id));
      folderEl.addEventListener('dragover', onDragOver);
      folderEl.addEventListener('drop', (e) => onDrop(e, 'folder', folder.id));
      
      foldersEl.appendChild(folderEl);
    });

    // Update folder select in viewer
    editFolder.innerHTML = '<option value="">No folder</option>';
    folders.forEach(folder => {
      const option = document.createElement('option');
      option.value = folder.id;
      option.textContent = folder.name;
      editFolder.appendChild(option);
    });

    // Update folder select in move modal
    folderSelect.innerHTML = '<option value="">No folder</option>';
    folders.forEach(folder => {
      const option = document.createElement('option');
      option.value = folder.id;
      option.textContent = folder.name;
      folderSelect.appendChild(option);
    });
  }

  function renderMediaList() {
    videoList.innerHTML = '';
    
    let filteredMedia = [...mediaItems];
    const searchTerm = searchInput.value.toLowerCase();
    
    if (searchTerm) {
      filteredMedia = filteredMedia.filter(item => 
        item.title?.toLowerCase().includes(searchTerm) ||
        item.tags?.toLowerCase().includes(searchTerm) ||
        item.description?.toLowerCase().includes(searchTerm)
      );
    }

    filteredMedia.forEach(media => {
      const mediaEl = document.createElement('div');
      mediaEl.className = 'vitem';
      mediaEl.draggable = true;
      
      const isPhoto = media.type === 'photo';
      const mediaTypeBadge = isPhoto ? 
        '<span class="media-type-badge media-type-photo">PHOTO</span>' :
        '<span class="media-type-badge media-type-video">VIDEO</span>';
      
      mediaEl.innerHTML = `
        <div class="thumb">
          ${media.thumbnail ? `<img src="${media.thumbnail}" alt="${media.title}">` : ''}
        </div>
        <div class="meta">
          <h3>${media.title || 'Untitled'} ${mediaTypeBadge}</h3>
          <p>${media.description || 'No description'}</p>
          <p class="small">${formatDate(media.createdAt)} ‚Ä¢ ${media.tags || 'No tags'}</p>
        </div>
      `;
      
      mediaEl.addEventListener('click', () => viewMedia(media));
      mediaEl.addEventListener('dragstart', (e) => onDragStart(e, 'media', media.id));
      mediaEl.addEventListener('dragover', onDragOver);
      mediaEl.addEventListener('drop', (e) => onDrop(e, 'media', media.id));
      
      mediaEl.addEventListener('contextmenu', (e) => {
        e.preventDefault();
        showContextMenu(e, media);
      });
      
      videoList.appendChild(mediaEl);
    });
  }

  function viewMedia(media) {
    currentMedia = media;
    viewer.style.display = 'block';
    
    if (media.type === 'photo') {
      videoPlayer.style.display = 'none';
      imageViewer.style.display = 'block';
      imageViewer.src = media.url;
    } else {
      imageViewer.style.display = 'none';
      videoPlayer.style.display = 'block';
      videoPlayer.src = media.url;
    }
    
    editTitle.value = media.title || '';
    editTags.value = media.tags || '';
    editFolder.value = media.folderId || '';
    editDescription.value = media.description || '';
  }

  function closeViewer() {
    viewer.style.display = 'none';
    currentMedia = null;
  }

  function saveMedia() {
    if (!currentMedia) return;

    const updates = {
      title: editTitle.value,
      tags: editTags.value,
      folderId: editFolder.value,
      description: editDescription.value,
      updatedAt: firebase.firestore.FieldValue.serverTimestamp()
    };

    db.collection('users').doc(currentUser.uid).collection('media').doc(currentMedia.id).update(updates)
      .then(() => {
        loadData();
        closeViewer();
      })
      .catch(error => {
        console.error('Error saving media:', error);
      });
  }

  function deleteMedia() {
    if (!currentMedia) return;

    if (confirm('Are you sure you want to delete this media?')) {
      // Delete from storage
      if (currentMedia.filePath) {
        storage.ref(currentMedia.filePath).delete().catch(console.error);
      }

      // Delete from Firestore
      db.collection('users').doc(currentUser.uid).collection('media').doc(currentMedia.id).delete()
        .then(() => {
          loadData();
          closeViewer();
        })
        .catch(error => {
          console.error('Error deleting media:', error);
        });
    }
  }

  // File upload
  function handleFileUpload(e) {
    const files = Array.from(e.target.files);
    const isPhoto = e.target.id === 'fileInputPhoto';
    
    files.forEach(file => {
      uploadFile(file, isPhoto ? 'photo' : 'video');
    });
    
    // Reset input
    e.target.value = '';
  }

  function uploadFile(file, type) {
    const fileId = Date.now().toString();
    const filePath = `users/${currentUser.uid}/media/${fileId}_${file.name}`;
    const fileRef = storage.ref(filePath);
    
    const uploadTask = fileRef.put(file);
    
    // Create progress element
    const progressEl = document.createElement('div');
    progressEl.className = 'upload-progress';
    progressEl.innerHTML = `
      <div class="small">Uploading ${file.name}...</div>
      <div class="progress-bar">
        <div class="progress-fill" style="width: 0%"></div>
      </div>
      <div class="progress-text">0%</div>
    `;
    document.querySelector('.sidebar').appendChild(progressEl);
    
    uploadTask.on('state_changed',
      (snapshot) => {
        const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
        const progressFill = progressEl.querySelector('.progress-fill');
        const progressText = progressEl.querySelector('.progress-text');
        progressFill.style.width = progress + '%';
        progressText.textContent = Math.round(progress) + '%';
      },
      (error) => {
        console.error('Upload error:', error);
        progressEl.remove();
      },
      async () => {
        const url = await uploadTask.snapshot.ref.getDownloadURL();
        
        // Check for duplicates
        const isDuplicate = mediaItems.some(item => 
          item.title === file.name && item.type === type
        );
        
        if (isDuplicate) {
          progressEl.innerHTML = `
            <div class="duplicate-warning">
              ‚ö†Ô∏è "${file.name}" already exists. Skipping duplicate.
            </div>
          `;
          setTimeout(() => progressEl.remove(), 3000);
          return;
        }
        
        // Create media item
        const mediaItem = {
          title: file.name,
          type: type,
          url: url,
          filePath: filePath,
          createdAt: firebase.firestore.FieldValue.serverTimestamp(),
          updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
          size: file.size,
          tags: '',
          description: '',
          folderId: ''
        };

        // Generate thumbnail for videos
        if (type === 'video') {
          try {
            mediaItem.thumbnail = await generateVideoThumbnail(file);
          } catch (error) {
            console.error('Error generating thumbnail:', error);
          }
        } else if (type === 'photo') {
          mediaItem.thumbnail = url;
        }

        await db.collection('users').doc(currentUser.uid).collection('media').add(mediaItem);
        progressEl.remove();
        loadData();
      }
    );
  }

  function generateVideoThumbnail(file) {
    return new Promise((resolve, reject) => {
      const video = document.createElement('video');
      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');
      
      video.src = URL.createObjectURL(file);
      video.addEventListener('loadeddata', () => {
        video.currentTime = 1;
      });
      
      video.addEventListener('seeked', () => {
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        ctx.drawImage(video, 0, 0);
        canvas.toBlob((blob) => {
          const thumbnailRef = storage.ref(`users/${currentUser.uid}/thumbnails/${Date.now()}_thumb.jpg`);
          thumbnailRef.put(blob).then(async (snapshot) => {
            const url = await snapshot.ref.getDownloadURL();
            resolve(url);
            URL.revokeObjectURL(video.src);
          }).catch(reject);
        }, 'image/jpeg', 0.7);
      });
      
      video.addEventListener('error', reject);
    });
  }

  // Drag and drop
  function onDragStart(e, type, id) {
    e.dataTransfer.setData('application/json', JSON.stringify({ type, id }));
    e.target.classList.add('dragging');
  }

  function onDragOver(e) {
    e.preventDefault();
    e.dataTransfer.dropEffect = 'move';
  }

  function onDrop(e, targetType, targetId) {
    e.preventDefault();
    
    try {
      const data = JSON.parse(e.dataTransfer.getData('application/json'));
      const { type, id } = data;
      
      e.target.classList.remove('drop-target');
      
      if (type === 'media' && targetType === 'folder') {
        // Move media to folder
        moveMediaToFolder(id, targetId);
      }
    } catch (error) {
      console.error('Drop error:', error);
    }
  }

  function moveMediaToFolder(mediaId, folderId) {
    db.collection('users').doc(currentUser.uid).collection('media').doc(mediaId).update({
      folderId: folderId,
      updatedAt: firebase.firestore.FieldValue.serverTimestamp()
    })
    .then(() => {
      loadData();
    })
    .catch(error => {
      console.error('Error moving media:', error);
    });
  }

  // Sync functions
  async function syncData() {
    if (isSyncing) return;
    
    isSyncing = true;
    updateSyncStatus('syncing');
    
    try {
      await loadFolders();
      await loadMedia();
      renderFolders();
      renderMediaList();
      updateSyncStatus('success');
    } catch (error) {
      console.error('Sync error:', error);
      updateSyncStatus('error');
    } finally {
      isSyncing = false;
    }
  }

  function updateSyncStatus(status) {
    syncIndicator.className = 'sync-indicator';
    syncIndicator.classList.add(status);
    
    const statusTexts = {
      ready: 'Ready to sync',
      syncing: 'Syncing...',
      success: 'Sync complete',
      error: 'Sync failed'
    };
    
    syncStatusText.textContent = statusTexts[status] || 'Unknown';
  }

  // Utility functions
  function formatDate(timestamp) {
    if (!timestamp) return 'Unknown date';
    const date = timestamp.toDate();
    return date.toLocaleDateString() + ' ' + date.toLocaleTimeString();
  }

  function filterByFolder(folderId) {
    // Implementation for folder filtering
    console.log('Filter by folder:', folderId);
  }

  function toggleSort() {
    // Implementation for sorting
    console.log('Toggle sort');
  }

  // Context menu functions
  function showContextMenu(e, media) {
    contextMenu.style.left = e.pageX + 'px';
    contextMenu.style.top = e.pageY + 'px';
    contextMenu.classList.add('show');
    currentMedia = media;
    
    // Update context menu items
    document.querySelectorAll('.context-item').forEach(item => {
      item.onclick = () => handleContextAction(item.dataset.action);
    });
  }

  function handleContextAction(action) {
    switch (action) {
      case 'rename':
        showRenameModal();
        break;
      case 'move':
        showMoveModal();
        break;
      case 'delete':
        deleteMedia();
        break;
    }
    contextMenu.classList.remove('show');
  }

  function showRenameModal() {
    if (!currentMedia) return;
    renameInput.value = currentMedia.title || '';
    renameModal.classList.add('show');
  }

  function showMoveModal() {
    if (!currentMedia) return;
    folderSelect.value = currentMedia.folderId || '';
    moveModal.classList.add('show');
  }

  function saveRename() {
    if (!currentMedia) return;
    
    const newTitle = renameInput.value.trim();
    if (!newTitle) return;
    
    db.collection('users').doc(currentUser.uid).collection('media').doc(currentMedia.id).update({
      title: newTitle,
      updatedAt: firebase.firestore.FieldValue.serverTimestamp()
    })
    .then(() => {
      loadData();
      renameModal.classList.remove('show');
    })
    .catch(error => {
      console.error('Error renaming media:', error);
    });
  }

  function saveMove() {
    if (!currentMedia) return;
    
    const folderId = folderSelect.value;
    
    db.collection('users').doc(currentUser.uid).collection('media').doc(currentMedia.id).update({
      folderId: folderId,
      updatedAt: firebase.firestore.FieldValue.serverTimestamp()
    })
    .then(() => {
      loadData();
      moveModal.classList.remove('show');
    })
    .catch(error => {
      console.error('Error moving media:', error);
    });
  }

  // URL Downloader functions
  function showUrlDownloader(type) {
    // Hide all downloaders first
    ninexbuddyDownloader.style.display = 'none';
    twitterDownloader.style.display = 'none';
    directUrlDownloader.style.display = 'none';
    
    // Show selected downloader
    switch (type) {
      case 'ninexbuddy':
        ninexbuddyDownloader.style.display = 'block';
        break;
      case 'twitter':
        twitterDownloader.style.display = 'block';
        break;
      case 'direct':
        directUrlDownloader.style.display = 'block';
        break;
    }
    
    urlDownloaderDropdown.classList.remove('show');
  }

  async function downloadViaNinexbuddy() {
    const url = document.getElementById('ninexbuddyUrl').value.trim();
    if (!url) return alert('Please enter a URL');
    
    const progressEl = document.getElementById('ninexbuddyProgress');
    const progressFill = document.getElementById('ninexbuddyProgressFill');
    const progressText = document.getElementById('ninexbuddyProgressText');
    
    progressEl.style.display = 'block';
    progressFill.style.width = '0%';
    progressText.textContent = '0%';
    
    try {
      // Simulate download progress (in a real app, you'd use actual progress events)
      for (let i = 0; i <= 100; i += 10) {
        await new Promise(resolve => setTimeout(resolve, 200));
        progressFill.style.width = i + '%';
        progressText.textContent = i + '%';
      }
      
      // Here you would integrate with 9xBuddy API
      alert('9xBuddy download completed! In a real implementation, this would download the video.');
      
    } catch (error) {
      console.error('9xBuddy download error:', error);
      alert('Download failed: ' + error.message);
    } finally {
      progressEl.style.display = 'none';
    }
  }

  async function downloadViaTwitter() {
    const url = document.getElementById('twitterUrl').value.trim();
    if (!url) return alert('Please enter a Twitter URL');
    
    const progressEl = document.getElementById('twitterProgress');
    const progressFill = document.getElementById('twitterProgressFill');
    const progressText = document.getElementById('twitterProgressText');
    
    progressEl.style.display = 'block';
    progressFill.style.width = '0%';
    progressText.textContent = '0%';
    
    try {
      // Simulate download progress
      for (let i = 0; i <= 100; i += 10) {
        await new Promise(resolve => setTimeout(resolve, 200));
        progressFill.style.width = i + '%';
        progressText.textContent = i + '%';
      }
      
      alert('Twitter download completed! In a real implementation, this would download the video.');
      
    } catch (error) {
      console.error('Twitter download error:', error);
      alert('Download failed: ' + error.message);
    } finally {
      progressEl.style.display = 'none';
    }
  }

  async function downloadDirectUrl() {
    const url = document.getElementById('directUrl').value.trim();
    if (!url) return alert('Please enter a direct video URL');
    
    const progressEl = document.getElementById('directUrlProgress');
    const progressFill = document.getElementById('directUrlProgressFill');
    const progressText = document.getElementById('directUrlProgressText');
    
    progressEl.style.display = 'block';
    progressFill.style.width = '0%';
    progressText.textContent = '0%';
    
    try {
      // Simulate download progress
      for (let i = 0; i <= 100; i += 10) {
        await new Promise(resolve => setTimeout(resolve, 200));
        progressFill.style.width = i + '%';
        progressText.textContent = i + '%';
      }
      
      alert('Direct URL download completed! In a real implementation, this would download the video.');
      
    } catch (error) {
      console.error('Direct URL download error:', error);
      alert('Download failed: ' + error.message);
    } finally {
      progressEl.style.display = 'none';
    }
  }

  // File conversion functions
  function handleFileConversion(conversion) {
    alert(`File conversion: ${conversion}\n\nIn a real implementation, this would convert the selected files using browser APIs or server processing.`);
    
    // Example implementation structure:
    switch (conversion) {
      case 'mp4-to-webm':
        // Convert MP4 to WebM using FFmpeg.js or similar
        break;
      case 'webm-to-mp4':
        // Convert WebM to MP4
        break;
      case 'jpg-to-png':
        // Convert JPG to PNG using Canvas API
        break;
      case 'png-to-jpg':
        // Convert PNG to JPG using Canvas API
        break;
    }
  }

  // Initialize the app when DOM is loaded
  document.addEventListener('DOMContentLoaded', initApp);
</script>
</body>
</html>
[file content end]