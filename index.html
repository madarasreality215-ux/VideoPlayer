<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MediaTracker Pro</title>
<!-- Build 2025-10-12 (progress update) -->
<style>
:root{--bg:#0b1220;--card:#0f1724;--card2:#141b2b;--txt:#e6eef9;--muted:rgba(230,238,249,.65);--acc:#7c3aed;--accH:#6d28d9;--thin:rgba(255,255,255,.15);--secBG:rgba(255,255,255,.03);--secBD:rgba(255,255,255,.08)}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--txt);font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica Neue,Arial}
header{position:sticky;top:0;z-index:50;display:flex;justify-content:space-between;align-items:center;background:var(--card);padding:12px 16px}
.title{margin:0;font-weight:700;font-size:18px;letter-spacing:.2px}
.btn{display:inline-flex;align-items:center;justify-content:center;gap:6px;height:42px;padding:10px 16px;border-radius:8px;border:none;font-weight:600;color:#fff;background:var(--acc);cursor:pointer;text-decoration:none;transition:background .2s,transform .1s}
.btn:hover{background:var(--accH);transform:translateY(-1px)}
.btn-matte{background:var(--card);color:var(--txt);border:1px solid var(--thin)}
.btn-matte:hover{background:#1a2333}
.container{display:grid;grid-template-columns:320px 1fr;gap:16px;padding:16px}
@media(max-width:900px){.container{grid-template-columns:1fr}}
.sidebar,.main{background:var(--card);padding:12px;border-radius:12px}
input,select,textarea{width:100%;padding:8px 10px;background:var(--card2);border:1px solid rgba(255,255,255,.1);border-radius:8px;color:var(--txt);font-size:14px}
input::placeholder,textarea::placeholder{color:rgba(230,238,249,.6)}
.section{background:var(--secBG);border:1px solid var(--secBD);border-radius:10px;padding:12px;margin-bottom:16px}
.section h3{margin:0 0 8px;font-size:15px;color:var(--acc);font-weight:700}
.row{display:flex;gap:10px;align-items:center;margin-bottom:10px}
.row:last-child{margin-bottom:0}
.empty{font-size:13px;color:var(--muted);text-align:center}
.videoList{display:flex;flex-direction:column;gap:8px}
.vitem{display:flex;gap:10px;align-items:center;padding:8px;border-radius:10px;background:rgba(255,255,255,.02);cursor:grab;transition:background .2s}
.vitem:hover{background:rgba(255,255,255,.05)}
.thumb{width:120px;height:72px;background:#000;border-radius:8px;overflow:hidden;flex-shrink:0}
.thumb video{width:100%;height:100%;object-fit:cover}
.meta{flex:1;min-width:0}
.meta h4{margin:0;font-size:14px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.meta p{margin:4px 0 0;font-size:12px;color:var(--muted)}
.status{display:flex;align-items:center;gap:8px;font-size:13px;color:var(--muted)}
.dot{width:8px;height:8px;border-radius:50%;background:#22c55e}
.upload-progress{height:5px;background:rgba(255,255,255,.1);border-radius:10px;overflow:hidden;margin-top:6px}
.upload-progress .bar{width:0%;height:100%;background:var(--acc);transition:width .2s ease}
.fade-out{opacity:0;transition:opacity .5s ease}
</style>
</head>
<body>
<header><h1 class="title">üì± MediaTracker Pro</h1>
<div style="display:flex;gap:8px"><a href="stats.html" class="btn btn-matte">üìä Stats</a><button id="signOutBtn" class="btn btn-matte">üö™ Sign Out</button></div></header>
<div class="container">
  <aside class="sidebar">
    <div class="section"><button id="syncBtn" class="btn" style="width:100%">üîÑ Sync Now</button><div class="status" style="margin-top:8px"><span class="dot" id="syncDot"></span><span id="syncText">Ready to sync</span></div></div>
    <div class="section"><h3>üê¶ Twitter/X Downloader</h3><div class="row"><input id="twUrl" placeholder="Paste Twitter/X URL here"></div><div class="row"><button id="twFetch" class="btn" style="width:100%">Fetch Twitter Media</button></div><div class="status" style="margin-top:8px"><span class="dot" id="apiDot" style="background:#60a5fa"></span><span id="apiText">Ready to detect media</span></div></div>
    <div id="tweetPreviewSection" class="section" style="display:none;"><h3>üéûÔ∏è Tweet Media Preview</h3><div id="tweetPreview" class="vitem" style="cursor:default;"><div class="thumb"><video id="tweetPreviewVideo" muted autoplay loop></video></div><div class="meta"><h4 id="tweetPreviewTitle">Previewing Tweet Media...</h4><p>Detected video ‚Ä¢ Ready to download</p></div></div><button id="tweetDownloadBtn" class="btn" style="width:100%;margin-top:10px;">‚¨áÔ∏è Download to VideoList</button></div>
  </aside>
  <main class="main">
    <div class="section"><div class="row"><input type="search" id="searchInput" placeholder="üîç Search videos..."><button id="sortBtn" class="btn">üìÖ Sort: Newest</button></div></div>
    <div id="videoList" class="videoList"></div>
  </main>
</div>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-storage-compat.js"></script>
<script>
const firebaseConfig={apiKey:"AIzaSyBH691ymS0uO7JejXC1MGFuhiIElD78UPY",authDomain:"personalplayer-c8d3b.firebaseapp.com",projectId:"personalplayer-c8d3b",storageBucket:"personalplayer-c8d3b.appspot.com",messagingSenderId:"396785312809",appId:"1:396785312809:web:02290950ec22a13165a838"};
firebase.initializeApp(firebaseConfig);
const auth=firebase.auth(),db=firebase.firestore(),storage=firebase.storage();
let me=null;auth.onAuthStateChanged(u=>{if(!u){location.href='login.html';return}me=u});
document.getElementById('signOutBtn').onclick=()=>auth.signOut().then(()=>location.href='login.html');

function setApiStatus(s){const t=document.getElementById('apiText'),d=document.getElementById('apiDot');if(s==='busy'){t.textContent='Fetching tweet...';d.style.background='#f59e0b'}else if(s==='ok'){t.textContent='Media found!';d.style.background='#22c55e'}else if(s==='err'){t.textContent='Failed to detect media';d.style.background='#ef4444'}else{t.textContent='Ready to detect media';d.style.background='#60a5fa'}}

async function fxGet(tw){const ep1=`https://api.fxtwitter.com/${tw}`,ep2=`https://api.vxtwitter.com/${tw}`;let r=await fetch(ep1);if(!r.ok)r=await fetch(ep2);const j=await r.json();if(!j?.tweet)throw new Error('No tweet');return j;}
let currentPreview=null;

async function fetchTweet(){const url=(document.getElementById('twUrl').value||'').trim();if(!url)return;setApiStatus('busy');try{const data=await fxGet(url);const medias=(data.tweet.media?.all||data.tweet.media?.videos||[]);if(!medias.length)throw new Error('No media found');const best=medias[0].variants?medias[0].variants.sort((a,b)=>(b.bitrate||0)-(a.bitrate||0))[0]:medias[0];const src=best.url||medias[0].url;if(!src)throw new Error('No valid video URL');currentPreview=src;const v=document.getElementById('tweetPreviewVideo');v.src=src;v.load();document.getElementById('tweetPreviewSection').style.display='block';setApiStatus('ok');}catch(e){console.error(e);setApiStatus('err');}}

document.getElementById('twFetch').onclick=fetchTweet;

document.getElementById('tweetDownloadBtn').onclick=async()=>{if(!currentPreview)return;await downloadDisplayUpload(currentPreview);document.getElementById('tweetPreviewSection').style.display='none';};

async function downloadDisplayUpload(src){const res=await fetch(src);if(!res.ok)throw new Error('fetch fail');const blob=await res.blob();const file=new File([blob],`tweet_${Date.now()}.mp4`,{type:'video/mp4'});const id='tmp_'+Date.now()+Math.random().toString(16).slice(2);const local=URL.createObjectURL(file);const videoList=document.getElementById('videoList');const el=document.createElement('div');el.className='vitem';el.dataset.mid=id;el.innerHTML=`<div class="thumb"><video src="${local}" muted loop></video></div><div class="meta"><h4>üéûÔ∏è Tweet Video</h4><p>${new Date().toLocaleString()}</p><div class="upload-progress"><div class="bar"></div></div></div>`;videoList.prepend(el);uploadToFirebase(id,file,'video');}

async function uploadToFirebase(tmpId,file,type){try{const path=`users/${me.uid}/${type}s/${Date.now()}_${file.name.replace(/[^a-zA-Z0-9_.-]/g,'_')}`;const ref=storage.ref().child(path);const task=ref.put(file);task.on('state_changed',snap=>{const pct=(snap.bytesTransferred/snap.totalBytes)*100;const bar=document.querySelector(\`[data-mid='${tmpId}'] .upload-progress .bar\`);if(bar)bar.style.width=pct+'%';},err=>console.error(err),async()=>{const url=await ref.getDownloadURL();await db.collection('media').add({userId:me.uid,name:file.name,url,type,createdAt:firebase.firestore.FieldValue.serverTimestamp()});const prog=document.querySelector(\`[data-mid='${tmpId}'] .upload-progress\`);if(prog){setTimeout(()=>prog.classList.add('fade-out'),1000);setTimeout(()=>prog.remove(),1600);}});}catch(e){console.error(e);}}
</script>
</body>
</html>
