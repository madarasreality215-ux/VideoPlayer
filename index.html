<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MediaTracker Pro ‚Äî Upload.io + LocalStorage</title>
<!-- Build 2025-10-12 | Fixed buttons + syntax | Upload.io storage | LocalStorage persistence | FixTweet preview | Progress bars | Drag/Drop + Trash -->
<style>
/* ====== STYLES (same visuals, functional buttons) ====== */
:root{--bg:#0b1220;--card:#0f1724;--card2:#141b2b;--txt:#e6eef9;--muted:rgba(230,238,249,.65);--acc:#7c3aed;--accH:#6d28d9;--thin:rgba(255,255,255,.15);--secBG:rgba(255,255,255,.03);--secBD:rgba(255,255,255,.08)}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--txt);font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica Neue,Arial}
header{position:sticky;top:0;z-index:50;display:flex;justify-content:space-between;align-items:center;background:var(--card);padding:12px 16px}
.title{margin:0;font-weight:700;font-size:18px;letter-spacing:.2px}
.btn{display:inline-flex;align-items:center;justify-content:center;gap:6px;height:42px;padding:10px 16px;border-radius:8px;border:none;font-weight:600;color:#fff;background:var(--acc);cursor:pointer;text-decoration:none;transition:background .2s,transform .1s}
.btn:hover{background:var(--accH);transform:translateY(-1px)}
.btn-matte{background:var(--card);color:var(--txt);border:1px solid var(--thin)}
.btn-matte:hover{background:#1a2333}
.container{display:grid;grid-template-columns:320px 1fr;gap:16px;padding:16px}
@media(max-width:900px){.container{grid-template-columns:1fr}}
.sidebar,.main{background:var(--card);padding:12px;border-radius:12px}
input,select,textarea{width:100%;padding:8px 10px;background:var(--card2);border:1px solid rgba(255,255,255,.1);border-radius:8px;color:var(--txt);font-size:14px}
input::placeholder,textarea::placeholder{color:rgba(230,238,249,.6)}
.section{background:var(--secBG);border:1px solid var(--secBD);border-radius:10px;padding:12px;margin-bottom:16px}
.section h3{margin:0 0 8px;font-size:15px;color:var(--acc);font-weight:700}
.row{display:flex;gap:10px;align-items:center;margin-bottom:10px}
.empty{font-size:13px;color:var(--muted);text-align:center}
.folders{display:flex;flex-direction:column;gap:6px;max-height:40vh;overflow:auto;padding-right:4px}
.frow{position:relative;display:flex;align-items:center;gap:8px;padding:8px;border-radius:8px;background:rgba(255,255,255,.02)}
.frow:hover{background:rgba(255,255,255,.05)}
.fchev{width:16px;text-align:center;opacity:.8;transition:transform .2s ease}
.frow.expanded>.fchev{transform:rotate(90deg)}
.fctrl{position:absolute;right:8px;display:flex;gap:6px;opacity:0;transition:opacity .2s ease}
.frow:hover .fctrl{opacity:1}
.fctrl button{background:transparent;border:1px solid rgba(255,255,255,.15);color:var(--txt);border-radius:6px;height:28px;padding:0 8px;cursor:pointer}
.children{overflow:hidden;max-height:0;opacity:.0;transition:max-height .25s ease,opacity .25s ease}
.children.show{opacity:1}
.videoList{display:flex;flex-direction:column;gap:8px}
.vitem{display:flex;gap:10px;align-items:center;padding:8px;border-radius:10px;background:rgba(255,255,255,.02);cursor:grab;transition:background .2s}
.vitem:hover{background:rgba(255,255,255,.05)}
.thumb{width:120px;height:72px;background:#000;border-radius:8px;overflow:hidden;flex-shrink:0}
.thumb img,.thumb video{width:100%;height:100%;object-fit:cover}
.meta{flex:1;min-width:0}
.meta h4{margin:0;font-size:14px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.meta p{margin:4px 0 0;font-size:12px;color:var(--muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.status{display:flex;align-items:center;gap:8px;font-size:13px;color:var(--muted);animation:fade .6s ease}
.dot{width:8px;height:8px;border-radius:50%;background:#22c55e;box-shadow:0 0 0 0 rgba(34,197,94,.7);animation:pulse 1.6s infinite}
@keyframes pulse{0%{box-shadow:0 0 0 0 rgba(34,197,94,.7)}70%{box-shadow:0 0 0 10px rgba(34,197,94,0)}100%{box-shadow:0 0 0 0 rgba(34,197,94,0)}}
@keyframes fade{from{opacity:0;transform:translateY(2px)}to{opacity:1;transform:translateY(0)}}

/* Viewer */
.viewer-full{display:none;position:fixed;inset:0;background:rgba(0,0,0,.96);opacity:0;transition:opacity .25s ease;pointer-events:none;z-index:1000;}
.viewer-full.show{display:block;opacity:1;pointer-events:auto;}
.viewer-wrap{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;padding:24px;}
.viewer-video{max-width:100%;max-height:100%;border-radius:12px;box-shadow:0 0 60px rgba(0,0,0,.6)}
.viewer-toolbar{position:absolute;top:0;left:0;right:0;height:56px;display:flex;align-items:center;justify-content:space-between;padding:0 16px;background:linear-gradient(to bottom, rgba(0,0,0,.65), rgba(0,0,0,0));color:#e6eef9;transition:opacity .2s ease;}
.viewer-close{position:absolute;top:12px;right:12px;font-size:28px;font-weight:700;color:#fff;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.15);border-radius:10px;width:40px;height:40px;display:flex;align-items:center;justify-content:center;cursor:pointer}
.viewer-close:hover{background:rgba(255,255,255,.2)}
.viewer-title{font-weight:600;max-width:60%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.viewer-actions{display:flex;gap:10px;align-items:center}
.viewer-dl,.viewer-back{height:36px;padding:0 12px;border-radius:8px;border:1px solid rgba(255,255,255,.2);background:rgba(255,255,255,.08);color:#fff;cursor:pointer}
.viewer-dl:hover,.viewer-back:hover{background:rgba(255,255,255,.18)}
.viewer-idle .viewer-toolbar{opacity:0}
.viewer-idle{cursor:none}

/* Trash & progress */
.trashOv{position:absolute;left:16px;right:16px;bottom:24px;padding:14px;background:rgba(239,68,68,.08);border:2px dashed rgba(239,68,68,.6);border-radius:12px;text-align:center;color:#ef4444;font-weight:600;opacity:0;pointer-events:none;transition:opacity .3s,transform .3s;backdrop-filter:blur(6px)}
.trashOv.active{opacity:1;transform:translateY(-6px)}
.upload-progress{height:5px;background:rgba(255,255,255,.1);border-radius:10px;overflow:hidden;margin-top:6px}
.upload-progress .bar{width:0%;height:100%;background:var(--acc);transition:width .2s ease}
.fade-out-preview{opacity:0;transition:opacity .8s ease}
</style>
</head>

<body>
<header>
  <h1 class="title">üì± MediaTracker Pro</h1>
  <div style="display:flex;gap:8px">
    <a href="stats.html" class="btn btn-matte">üìä Stats</a>
  </div>
</header>

<div class="container">
  <aside class="sidebar" id="sidebar" style="position:relative">
    <div class="section"><div class="status"><span class="dot"></span><span>Local mode: Upload.io + LocalStorage</span></div></div>
    <div class="section"><h3>üìÅ Folder Management</h3><div class="row"><input id="newFolderName" placeholder="New folder name"></div><button id="addFolderBtn" class="btn" style="width:100%">üìÅ Add Folder</button></div>
    <div class="section"><h3>üìÇ Your Folders</h3><div id="folders" class="folders"><div class="empty" id="noFolders">No folders yet. Create one above!</div></div></div>
    <div class="section"><h3>‚ûï Add Media</h3><div class="row"><button id="addVideoBtn" class="btn" style="flex:1">üé• Add Videos</button><button id="addPhotoBtn" class="btn" style="flex:1;background:#10b981">üì∑ Add Photos</button></div><div class="empty" style="margin-top:6px">Supports MP4, WebM, MOV, JPG, PNG, GIF</div></div>
    <div class="section"><h3>üê¶ Twitter/X Downloader</h3><div class="row"><input id="twUrl" placeholder="Paste Twitter/X URL here"></div><div class="row"><button id="twFetch" class="btn" style="width:100%">Fetch Twitter Media</button></div></div>
    <div id="tweetPreviewSection" class="section" style="display:none;"><h3>üéûÔ∏è Tweet Media Preview</h3><div id="tweetPreview" class="vitem" style="cursor:default;"><div class="thumb"><video id="tweetPreviewVideo" muted autoplay loop playsinline></video></div><div class="meta"><h4 id="tweetPreviewTitle">Previewing Tweet Media‚Ä¶</h4><p>Detected video ‚Ä¢ Ready to download</p></div></div><button id="tweetDownloadBtn" class="btn" style="width:100%;margin-top:10px;">‚¨áÔ∏è Download to VideoList</button></div>
    <div id="trashBinOverlay" class="trashOv">üóëÔ∏è Drop to Delete Media</div>
  </aside>

  <main class="main">
    <div class="section"><div class="row"><input type="search" id="searchInput" placeholder="üîç Search videos..."><button id="sortBtn" class="btn">üìÖ Sort: Newest</button></div></div>
    <div id="videoList" class="videoList"></div>
  </main>
</div>

<!-- Viewer -->
<div id="viewer" class="viewer-full">
  <div class="viewer-wrap">
    <div class="viewer-toolbar">
      <button class="viewer-back" id="viewerBack">‚Üê Back</button>
      <div class="viewer-title" id="viewerTitle"></div>
      <div class="viewer-actions"><a id="viewerDownload" class="viewer-dl" download>‚¨áÔ∏è Download</a></div>
    </div>
    <button class="viewer-close" id="closePopup">√ó</button>
    <video id="viewerVideo" class="viewer-video" controls playsinline></video>
  </div>
</div>

<script>
const UPLOAD_IO_KEY="public_G22nhy92HumZ7P23KoW9jdRoXCuN";
const UPLOAD_ENDPOINT="https://api.upload.io/v1/files/basic";

let currentFolderId="",sortOrder="newest";
const foldersMap=new Map(),mediaMap=new Map(),expandedSet=new Set();
const LS_KEYS={folders:"mtp_folders",media:"mtp_media",expanded:"mtp_expanded"};
const foldersEl=document.getElementById('folders'),noFolders=document.getElementById('noFolders'),videoListEl=document.getElementById('videoList');
const esc=s=>String(s||'').replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]));
const genId=(p="id")=>p+"_"+Date.now()+"_"+Math.random().toString(36).slice(2,8);
function saveState(){localStorage.setItem(LS_KEYS.folders,JSON.stringify([...foldersMap.values()]));localStorage.setItem(LS_KEYS.media,JSON.stringify([...mediaMap.values()]));localStorage.setItem(LS_KEYS.expanded,JSON.stringify([...expandedSet]));}
function loadState(){try{const f=JSON.parse(localStorage.getItem(LS_KEYS.folders)||"[]"),m=JSON.parse(localStorage.getItem(LS_KEYS.media)||"[]"),ex=JSON.parse(localStorage.getItem(LS_KEYS.expanded)||"[]");f.forEach(x=>foldersMap.set(x.id,x));m.forEach(x=>mediaMap.set(x.id,x));ex.forEach(id=>expandedSet.add(id));}catch(e){}}

function wireUI(){
 document.getElementById('addFolderBtn').onclick=onAddFolder;
 document.getElementById('addVideoBtn').onclick=()=>pickFiles('video');
 document.getElementById('addPhotoBtn').onclick=()=>pickFiles('image');
 document.getElementById('searchInput').oninput=renderVideos;
 document.getElementById('sortBtn').onclick=()=>{sortOrder=sortOrder==='newest'?'oldest':'newest';document.getElementById('sortBtn').textContent=sortOrder==='newest'?'üìÖ Sort: Newest':'üìÖ Sort: Oldest';renderVideos();};
 document.getElementById('closePopup').onclick=closeViewer;
 document.getElementById('twFetch').onclick=()=>fetchTweet();
 document.getElementById('tweetDownloadBtn').onclick=()=>downloadPreview();
}

function onAddFolder(){const nf=document.getElementById('newFolderName');const name=(nf.value||'').trim();if(!name)return;const id=genId('fld');foldersMap.set(id,{id,name,parentId:currentFolderId||"",createdAt:Date.now()});nf.value='';renderFolders();saveState();}
function renderFolders(){const roots=[];foldersMap.forEach(v=>{if(!v.parentId)roots.push(v)});noFolders.style.display=roots.length?"none":"block";const out=[];
 function rowHtml(n,d){const expanded=expandedSet.has(n.id);return `<div class="frow ${expanded?'expanded':'collapsed'}" data-fid="${n.id}" style="padding-left:${8+d*14}px"><span class="fchev">‚ñ∂</span><span class="fname">üìÅ ${esc(n.name)}</span><div class="fctrl"><button data-act="add">‚ûï</button><button data-act="ren">‚úèÔ∏è</button><button data-act="del">üóëÔ∏è</button></div></div><div class="children ${expanded?'show':''}" data-ch-of="${n.id}" style="max-height:${expanded?9999:0}px">${childHtml(n.id,d+1)}</div>`;}
 function childHtml(pid,d){let s='';foldersMap.forEach(ch=>{if(ch.parentId===pid)s+=rowHtml(ch,d)});return s;}
 roots.forEach(r=>out.push(rowHtml(r,0)));foldersEl.innerHTML=out.join('');
 foldersEl.querySelectorAll('.frow').forEach(el=>{
  const id=el.getAttribute('data-fid');
  el.onclick=e=>{if(e.target.closest('.fctrl'))return;toggleFolder(id)};
  el.querySelectorAll('.fctrl button').forEach(b=>{
   b.onclick=ev=>{ev.stopPropagation();const act=b.dataset.act;if(act==='add')inlineAddSub(id,el);if(act==='ren')inlineRename(id,el);if(act==='del')confirmDeleteFolder(id);};
  });
  el.ondragover=ev=>{ev.preventDefault();el.style.outline=`1px solid var(--acc)`};
  el.ondragleave=()=>{el.style.outline='none'};
  el.ondrop=e=>{e.preventDefault();el.style.outline='none';const mid=e.dataTransfer.getData('media-id');if(mid)moveMediaToFolder(mid,id)};
 });
}
function toggleFolder(id){expandedSet.has(id)?expandedSet.delete(id):expandedSet.add(id);renderFolders();renderVideos();saveState();}
function inlineAddSub(parentId,rowEl){const inp=document.createElement('input');inp.placeholder='New subfolder name';inp.style.marginTop='6px';const wrap=document.createElement('div');wrap.style.paddingLeft='28px';wrap.appendChild(inp);rowEl.insertAdjacentElement('afterend',wrap);inp.focus();const save=()=>{const name=(inp.value||'').trim();wrap.remove();if(!name
