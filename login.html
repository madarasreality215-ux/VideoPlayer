<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Oathbound Archives — Login</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@500;700&display=swap" rel="stylesheet">

<style>
/* === Oathbound Archives – Cinematic Login (Standalone) === */
.background-layer {
  position: fixed;
  inset: 0;
  background: url("https://i.postimg.cc/wjqh586L/The-fool.jpg") center/cover no-repeat;
  filter: brightness(0.35) contrast(1.05) blur(4px);
  opacity: 0.45;
  z-index: -3;
}
#visualizer {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: -2;
  display: block;
  pointer-events: none;
  opacity: 1;
  filter: blur(1.2px);
  transition: opacity .6s ease;
}
.card-auth {
  background: #2a2a2e !important;
  border: 1px solid rgba(200,200,210,0.20);
  box-shadow: 0 0 20px rgba(255,255,255,0.05), inset 0 0 12px rgba(255,255,255,0.08);
  border-radius: 14px;
  padding: 24px 30px;
  position: relative;
  z-index: 10;
  color: #e8e8ea;
  max-width: 420px;
  margin: 10vh auto 0;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial, 'Noto Sans', 'Apple Color Emoji','Segoe UI Emoji';
}
.card-auth input, .card-auth button {
  width: 100%;
  box-sizing: border-box;
  margin-top: 10px;
  padding: 12px 14px;
  border-radius: 10px;
  border: 1px solid rgba(200,200,210,0.25);
  background: #212126;
  color: #f2f3f7;
  outline: none;
  transition: box-shadow 200ms ease, transform 200ms ease, background 200ms ease;
}
.card-auth input::placeholder { color: #aeb0b7; }
.card-auth input:focus, .card-auth button:hover {
  box-shadow: 0 0 16px rgba(210,210,220,0.35), 0 0 2px rgba(255,255,255,0.15);
  transform: translateY(-1px);
}
.card-auth button {
  background: #3b3f4d;
  cursor: pointer;
  font-weight: 600;
}
#awakenOverlay {
  position: fixed;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(10,9,8,0.92);
  z-index: 999999 !important;
  cursor: pointer;
  opacity: 1;
  pointer-events: all !important;
  transition: opacity 900ms ease;
}
#awakenOverlay.hidden { opacity: 0; pointer-events: none; }
#awakenOverlay .awaken-text{
  font-family: "Cinzel", Georgia, serif;
  font-size: 28px;
  letter-spacing: 1px;
  color: #d9d2c2;
  text-shadow: 0 0 6px rgba(255, 214, 140, 0.45), 0 0 18px rgba(255, 194, 100, 0.25), 0 0 36px rgba(255, 170, 60, 0.15);
  padding: 18px 26px;
  border: 1px solid rgba(200,190,170,0.25);
  border-radius: 10px;
  background: radial-gradient(ellipse at center, rgba(40,36,30,0.35), rgba(24,22,20,0.15) 60%, rgba(0,0,0,0));
}
#oathAcceptedOverlay {
  position:fixed; inset:0; display:none; align-items:center; justify-content:center;
  background:rgba(0,0,0,0.6); z-index:9999;
}
#oathAcceptedOverlay .crest {
  text-align:center; color:#e8e6ff; font-family:Georgia,serif; letter-spacing:1px;
  padding:28px 36px; border:2px solid rgba(200,200,210,0.35); border-radius:16px;
  box-shadow:0 0 30px rgba(200,200,210,0.25), inset 0 0 20px rgba(210,210,220,0.18);
  background: radial-gradient(ellipse at center, rgba(23,27,40,0.95), rgba(10,12,18,0.95));
}
#oathAcceptedOverlay h2 { margin:0 0 8px 0; font-size:26px; color:#e6e9f5; }
@media (max-width: 600px) {
  .card-auth { margin-top: 8vh; padding: 18px 20px; border-radius: 12px; }
  #awakenOverlay .awaken-text { font-size: 22px; padding: 14px 18px; }
}
</style>
</head>
<body>
<div class="background-layer"></div>
<div id="awakenOverlay"><div class="awaken-text">Click to Awaken the Archive</div></div>
<div id="oathAcceptedOverlay">
  <div class="crest">
    <h2>Oath Bound – Access Granted</h2>
    <p style="margin:0;opacity:0.9;">Welcome to the Oathbound Archives</p>
  </div>
</div>
<canvas id="visualizer"></canvas>
<div class="card-auth">
  <h1 style="margin:0 0 8px 0;">Oathbound Archives</h1>
  <p class="subtitle" style="margin:0 0 14px 0; opacity:.85;">Enter the Royal Gateway</p>
  <label for="email">Scroll of Identity</label>
  <input id="email" type="email" placeholder="Scroll of Identity" autocomplete="username"/>
  <label for="password" style="margin-top:10px;">Sigil Key</label>
  <input id="password" type="password" placeholder="Sigil Key" autocomplete="current-password"/>
  <button id="loginBtn" style="margin-top:12px;">Swear Thy Oath</button>
  <div id="loginMsg" style="margin-top:10px; font-size: 0.9rem; opacity:.85;"></div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>

<script>
const canvas=document.getElementById("visualizer");
const ctx=canvas.getContext("2d");
function fitCanvas(){canvas.width=window.innerWidth;canvas.height=window.innerHeight;}
fitCanvas();window.addEventListener("resize",fitCanvas);

const AUDIO_SRC="golden_brown_vibes.mp3";
const audio=new Audio(AUDIO_SRC);
audio.loop=true;audio.crossOrigin="anonymous";audio.volume=0;
let audioCtx;try{audioCtx=new (window.AudioContext||window.webkitAudioContext)();}catch(e){}
let analyser,dataArray,source;
if(audioCtx){
  try{
    source=audioCtx.createMediaElementSource(audio);
    analyser=new AnalyserNode(audioCtx,{fftSize:1024});
    source.connect(analyser);
    analyser.connect(audioCtx.destination);
    dataArray=new Uint8Array(analyser.frequencyBinCount);
  }catch(e){}
}

let running=false,targetVolume=0.75,fadeInt=null;
function fadeAudio(toVol,dur=1500){
  if(!audio)return;
  clearInterval(fadeInt);
  const steps=30,dt=dur/steps,diff=toVol-audio.volume;
  let i=0;fadeInt=setInterval(()=>{
    i++;audio.volume+=diff/steps;
    if(i>=steps){audio.volume=toVol;clearInterval(fadeInt);if(toVol===0){try{audio.pause();}catch(_){}}}
  },dt);
}

function paintBackground(){
  const g=ctx.createLinearGradient(0,0,0,canvas.height);
  g.addColorStop(0,'#1a1a1d');g.addColorStop(1,'#2b2b30');
  ctx.fillStyle=g;ctx.fillRect(0,0,canvas.width,canvas.height);
}
function animate(){
  if(!running)return;requestAnimationFrame(animate);
  paintBackground();
}
function showVisualizer(){running=true;canvas.style.opacity='1';animate();}
function hideVisualizer(){running=false;canvas.style.opacity='0';fadeAudio(0,1500);}
function showOathAccepted(){
  const el=document.getElementById('oathAcceptedOverlay');
  if(!el)return;el.style.display='flex';setTimeout(()=>{el.style.display='none';},1500);
}

const awakenEl=document.getElementById('awakenOverlay');
if(awakenEl){
  awakenEl.addEventListener('click', async ()=>{
    awakenEl.classList.add('hidden');
    showVisualizer(); // start visuals immediately
    try{
      if(audioCtx){
        await audioCtx.resume();
        await audio.play().catch(()=>{});
        fadeAudio(targetVolume,1500);
      }
    }catch(e){console.warn('Audio failed to play:',e);}
  });
}

const emailEl=document.getElementById('email');
const passEl=document.getElementById('password');
const btnEl=document.getElementById('loginBtn');
const msgEl=document.getElementById('loginMsg');

if(btnEl){
  btnEl.addEventListener('click',async()=>{
    if(!window.firebase||!firebase.auth){msgEl.textContent="Firebase not loaded.";return;}
    const email=(emailEl&&emailEl.value)||"";
    const pass=(passEl&&passEl.value)||"";
    try{
      await firebase.auth().signInWithEmailAndPassword(email,pass);
    }catch(err){
      msgEl.textContent=err&&err.message?err.message:"Login failed.";
    }
  });
}

if(window.firebase&&firebase.auth){
  firebase.auth().onAuthStateChanged((u)=>{
    const bg=document.querySelector('.background-layer');
    if(u){
      if(bg){bg.style.background='#0B1220';bg.style.filter='none';bg.style.opacity='1';}
      try{document.getElementById('visualizer').style.display='none';}catch(_){}
      fadeAudio(0,1500);hideVisualizer();showOathAccepted();
      setTimeout(()=>{window.location.href='index.html';},1500);
    }else{
      if(bg){
        bg.style.background='url("https://i.postimg.cc/wjqh586L/The-fool.jpg") center/cover no-repeat';
        bg.style.filter='brightness(0.35) contrast(1.05) blur(4px)';
        bg.style.opacity='0.45';
      }
      if(awakenEl)awakenEl.classList.remove('hidden');
    }
  });
}else{
  // fallback if Firebase not loaded
  document.getElementById('awakenOverlay').classList.remove('hidden');
}
</script>
</body>
</html>